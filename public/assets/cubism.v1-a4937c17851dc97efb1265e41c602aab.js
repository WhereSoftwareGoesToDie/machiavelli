!function(t){function n(t){return t}function e(){}function r(t){return Math.floor(t/1e3)}function o(t){{var n=t.indexOf("|"),e=t.substring(0,n),r=e.lastIndexOf(","),o=e.lastIndexOf(",",r-1),a=e.lastIndexOf(",",o-1);1e3*e.substring(a+1,o),1e3*e.substring(r+1)}return t.substring(n+1).split(",").slice(1).map(function(t){return+t})}function a(t){return Math.floor(t/1e3)}function u(t){if(!(t instanceof e))throw new Error("invalid context");this.context=t}function l(t,n){return function(e,r,o,a){t(new Date(+e+n),new Date(+r+n),o,a)}}function c(t,n){u.call(this,t),n=+n;var e=n+"";this.valueOf=function(){return n},this.toString=function(){return e}}function s(t,n){function e(n,e){if(e instanceof u){if(n.context!==e.context)throw new Error("mismatch context")}else e=new c(n.context,e);u.call(this,n.context),this.left=n,this.right=e,this.toString=function(){return n+" "+t+" "+e}}var r=e.prototype=Object.create(u.prototype);return r.valueAt=function(t){return n(this.left.valueAt(t),this.right.valueAt(t))},r.shift=function(t){return new e(this.left.shift(t),this.right.shift(t))},r.on=function(t,n){return arguments.length<2?this.left.on(t):(this.left.on(t,n),this.right.on(t,n),this)},function(t){return new e(this,t)}}function f(t){return 16777214&t}function h(t){return(t+1&16777214)-1}function m(t){t.style("position","absolute").style("top",0).style("bottom",0).style("width","1px").style("pointer-events","none")}function g(t){return t+"px"}var v=t.cubism={version:"1.5.0"},p=0;v.option=function(t,n){var e=v.options(t);return e.length?e[0]:n},v.options=function(t,n){for(var e,r=location.search.substring(1).split("&"),o=[],a=-1,i=r.length;++a<i;)(e=r[a].split("="))[0]==t&&o.push(decodeURIComponent(e[1]));return o.length||arguments.length<2?o:n},v.context=function(){function t(){var t=Date.now();return r=new Date(Math.floor((t-f-h)/c)*c),n=new Date(r-s*c),a=new Date(Math.floor((t-f)/c)*c),o=new Date(a-s*c),v.domain([n,r]),l}var n,r,o,a,i,u,l=new e,c=1e4,s=1440,f=5e3,h=5e3,m=!1,g=d3.dispatch("prepare","beforechange","change","focus"),v=l.scale=d3.time.scale().range([0,s]);return l.start=function(){i&&clearTimeout(i);var t=+a+f-Date.now();return h>t&&(t+=c),i=setTimeout(function e(){a=new Date(Math.floor((Date.now()-f)/c)*c),o=new Date(a-s*c),g.prepare.call(l,o,a),setTimeout(function(){v.domain([n=o,r=a]),g.beforechange.call(l,o,a),g.change.call(l,o,a),g.focus.call(l,u)},h),i=setTimeout(e,c)},t),l},l.stop=function(){return i=clearTimeout(i),l},i=setTimeout(l.start,10),l.step=function(n){return arguments.length?(c=+n,t()):c},l.size=function(n){return arguments.length?(v.range([0,s=+n]),t()):s},l.serverDelay=function(n){return arguments.length?(f=+n,t()):f},l.utcTime=function(n){return arguments.length?(m=n,d=d3.time.scale(),n&&(d=d3.time.scale.utc()),v=l.scale=d.range([0,s]),t()):m},l.clientDelay=function(n){return arguments.length?(h=+n,t()):h},l.focus=function(t){return g.focus.call(l,u=t),l},l.on=function(t,e){return arguments.length<2?g.on(t):(g.on(t,e),null!=e&&(/^prepare(\.|$)/.test(t)&&e.call(l,o,a),/^beforechange(\.|$)/.test(t)&&e.call(l,n,r),/^change(\.|$)/.test(t)&&e.call(l,n,r),/^focus(\.|$)/.test(t)&&e.call(l,u)),l)},d3.select(window).on("keydown.context-"+ ++p,function(){switch(!d3.event.metaKey&&d3.event.keyCode){case 37:null==u&&(u=s-1),u>0&&l.focus(--u);break;case 39:null==u&&(u=s-2),s-1>u&&l.focus(++u);break;default:return}d3.event.preventDefault()}),t()};var y=v.context.prototype=e.prototype;y.constant=function(t){return new c(this,+t)},y.cube=function(t){arguments.length||(t="");var n={},e=this;return n.metric=function(n){return e.metric(function(e,r,o,a){d3.json(t+"/1.0/metric?expression="+encodeURIComponent(n)+"&start="+x(e)+"&stop="+x(r)+"&step="+o,function(t){return t?void a(null,t.map(function(t){return t.value})):a(new Error("unable to load data"))})},n+="")},n.toString=function(){return t},n};var x=d3.time.format.iso;if(v.context().utcTime())var x=d3.time.format.utc.iso;y.librato=function(t,n){function e(t){enable_log&&console.log(t)}function r(t,n,r){e("---------------------- Starting request"),e("START: "+new Date(1e3*t)),e("STOP : "+new Date(1e3*n)),e("STEP : "+r);var o=(n-t)/r;e("# of measurements necessary: "+o)}function o(t){var n=avail_rsts[0],e=avail_rsts[avail_rsts.length];if(t>=e)return e;if(n>=t)return n;var r,o,a;for(a=t;e>=a;a++)if(r=avail_rsts.indexOf(a),r>-1){o=avail_rsts[r];break}var i;for(a=t;a>=n;a--)if(r=avail_rsts.indexOf(a),r>-1){i=avail_rsts[r];break}return t-i>o-t?o:i}function a(t,n,e){var r,a=n-t,i=2419200,u=604800,l=172800;return a>i?3600:(r=o(e),a>u&&900>r?900:a>l&&60>r?60:r)}var u={},l=this;auth_string="Basic "+btoa(t+":"+n),enable_log=!0,avail_rsts=[1,60,900,3600];var c=function(t,n){function o(n,o,i){var u="start_time="+n+"&end_time="+o+"&resolution="+a(n,o,i);return full_url=l+"/"+t+"?"+u,e("full_url = "+full_url),r(n,o,i),full_url}function u(t,n,e,r){var o=[];for(i=t;n>=i;i+=e){for(var a=[];r.length&&r[0].measure_time<=i;)a.push(r.shift().value);var u;u=a.length?a.reduce(function(t,n){return t+n})/a.length:o.length?o[o.length-1]:0,o.push(u)}return o}var l="https://metrics-api.librato.com/v1/metrics";return request={},request.fire=function(t,r,a,i){function l(s){d3.json(s).header("X-Requested-With","XMLHttpRequest").header("Authorization",auth_string).header("Librato-User-Agent","cubism/"+v.version).get(function(s,f){if(s)e("There was an error when performing the librato request:"),e(s);else{e("# of partial measurements: "+f.measurements[n].length),f.measurements[n].forEach(function(t){c.push(t)});var h="query"in f&&"next_time"in f.query;if(h)e("Requesting more values"),l(o(f.query.next_time,r,a));else{e("total number of measurements from librato: "+c.length);var m=u(t,r,a,c);e("number of measurements after adjusting time values: "+m.length),i(m)}}})}var c=[];l(o(t,r,a))},request};return u.metric=function(t,n){return l.metric(function(e,r,o,a){c(t,n).fire(b(e),b(r),b(o),function(t){a(null,t)})},t+="")},u.toString=function(){return"librato"},u};var b=function(t){return Math.floor(t/1e3)};y.graphite=function(t){arguments.length||(t="");var n={},e=this;return n.metric=function(n){var a="sum",i=e.metric(function(e,i,u,l){var c=n;1e4!==u&&(c="summarize("+c+",'"+(u%36e5?u%6e4?u/1e3+"sec":u/6e4+"min":u/36e5+"hour")+"','"+a+"')"),d3.text(t+"/render?format=raw&target="+encodeURIComponent("alias("+c+",'')")+"&from="+r(e-2*u)+"&until="+r(i-1e3),function(t){return t?void l(null,o(t)):l(new Error("unable to load data"))})},n+="");return i.summarize=function(t){return a=t,i},i},n.find=function(n,e){d3.json(t+"/metrics/find?format=completer&query="+encodeURIComponent(n),function(t){return t?void e(null,t.metrics.map(function(t){return t.path})):e(new Error("unable to find metrics"))})},n.toString=function(){return t},n},y.machiavelli=function(t){arguments.length||(t="");var n={},e=this;return n.metric=function(n,r){r=r||n;var o=e.metric(function(e,r,o,i){feed=t+"/metric/?metric="+n+"&start="+a(e-2*o)+"&stop="+a(r-1e3)+"&step="+o/1e3,d3.json(feed,function(t){return t&&0!=t.length?t.error?i(new Error("machiavelli error: "+t.error)):void i(null,t.map(function(t){return t.y})):i(new Error("error loading data - no data returned"))})},r);return o},n.toString=function(){return t},n},y.gangliaWeb=function(t){var n="",e="/ganglia2/";arguments.length&&(t.host&&(n=t.host),t.uriPathPrefix&&(e=t.uriPathPrefix,"/"!=e[0]&&(e="/"+e),"/"!=e[e.length-1]&&(e+="/")));var r={},o=this;return r.metric=function(t){var r=t.clusterName,a=t.metricName,i=t.hostName,u=t.isReport||!1,l=t.titleGenerator||function(){return"clusterName:"+r+" metricName:"+a+(i?" hostName:"+i:"")},c=t.onChangeCallback,s=u?"g":"m",f=o.metric(function(t,o,u,l){function c(){return"c="+r+"&"+s+"="+a+(i?"&h="+i:"")+"&cs="+t/1e3+"&ce="+o/1e3+"&step="+u/1e3+"&graphlot=1"}d3.json(n+e+"graph.php?"+c(),function(t){return t?void l(null,t[0].data):l(new Error("Unable to fetch GangliaWeb data"))})},l(t));return f.toString=function(){return l(t)},c&&f.on("change",c),f},r.toString=function(){return n+e},r};var w=u.prototype;v.metric=u,w.valueAt=function(){return 0/0},w.alias=function(t){return this.toString=function(){return t},this},w.extent=function(){for(var t,n=0,e=this.context.size(),r=1/0,o=-1/0;++n<e;)t=this.valueAt(n),r>t&&(r=t),t>o&&(o=t);return[r,o]},w.on=function(){return arguments.length<2?null:this},w.shift=function(){return this},w.on=function(){return arguments.length<2?null:this},y.metric=function(t,n){function e(n,e){var r=Math.min(m,Math.round((n-f)/h));if(r&&!a){a=!0,r=Math.min(m,r+A);var o=new Date(e-r*h);t(o,e,h,function(t,n){if(a=!1,t)return console.warn(t);for(var r=isFinite(f)?Math.round((o-f)/h):0,i=0,u=n.length;u>i;++i)g[i+r]=n[i];d.change.call(c,f,e)})}}function r(t,n){isFinite(f)||(f=t),g.splice(0,Math.max(0,Math.min(m,Math.round((t-f)/h)))),f=t,o=n}var o,a,i=this,c=new u(i),s=".metric-"+ ++p,f=-1/0,h=i.step(),m=i.size(),g=[],d=d3.dispatch("change"),v=0;return c.valueAt=function(t){return g[t]},c.shift=function(n){return i.metric(l(t,+n))},c.on=function(t,n){return arguments.length?(null==n?null!=d.on(t)&&0==--v&&i.on("prepare"+s,null).on("beforechange"+s,null):null==d.on(t)&&1==++v&&i.on("prepare"+s,e).on("beforechange"+s,r),d.on(t,n),null!=n&&/^change(\.|$)/.test(t)&&n.call(i,f,o),c):d.on(t)},arguments.length>1&&(c.toString=function(){return n}),c};var A=6,z=c.prototype=Object.create(u.prototype);z.valueAt=function(){return+this},z.extent=function(){return[+this,+this]},w.add=s("+",function(t,n){return t+n}),w.subtract=s("-",function(t,n){return t-n}),w.multiply=s("*",function(t,n){return t*n}),w.divide=s("/",function(t,n){return t/n}),y.horizon=function(){function t(t){t.on("mousemove.horizon",function(){e.focus(Math.round(d3.mouse(this)[0]))}).on("mouseout.horizon",function(){e.focus(null)}),t.append("canvas").attr("width",a).attr("height",i),t.append("span").attr("class","title").text(s),t.append("span").attr("class","value"),t.each(function(t,s){function m(t){R.save();var n=b.extent();v=n.every(isFinite),null!=z&&(n=z);var l=0,c=Math.max(-n[0],n[1]);if(this===e){if(c==d){l=a-A;var s=(t-S)/M;if(a>s){var f=o.getContext("2d");f.clearRect(0,0,a,i),f.drawImage(R.canvas,s,0,a-s,i,0,0,a-s,i),R.clearRect(0,0,a,i),R.drawImage(f.canvas,0,0)}}S=t}u.domain([0,d=c]),R.clearRect(l,0,a-l,i);for(var h,m=0;D>m;++m){R.fillStyle=w[D+m];var g=(m-D+1)*i;u.range([D*i+g,g]),g=u(0);for(var p,y=l,x=a;x>y;++y)p=b.valueAt(y),0>=p?h=!0:void 0!==p&&R.fillRect(y,p=u(p),1,g-p)}if(h){"offset"===r&&(R.translate(0,i),R.scale(1,-1));for(var m=0;D>m;++m){R.fillStyle=w[D-1-m];var g=(m-D+1)*i;u.range([D*i+g,g]),g=u(0);for(var p,y=l,x=a;x>y;++y)p=b.valueAt(y),p>=0||R.fillRect(y,u(-p),1,g-u(-p))}}R.restore()}function g(t){null==t&&(t=a-1);var n=b.valueAt(t);_.datum(n).text(isNaN(n)?null:f)}var d,v,y=this,x=++p,b="function"==typeof l?l.call(y,t,s):l,w="function"==typeof h?h.call(y,t,s):h,z="function"==typeof c?c.call(y,t,s):c,S=-1/0,M=e.step(),R=d3.select(y).select("canvas"),_=d3.select(y).select(".value"),D=w.length>>1;R.datum({id:x,metric:b}),R=R.node().getContext("2d"),e.on("change.horizon-"+x,m),e.on("focus.horizon-"+x,g),b.on("change.horizon-"+x,function(t,e){m(t,e),g(),v&&b.on("change.horizon-"+x,n)})})}var e=this,r="offset",o=document.createElement("canvas"),a=o.width=e.size(),i=o.height=30,u=d3.scale.linear().interpolate(d3.interpolateRound),l=n,c=null,s=n,f=d3.format(".4s"),h=["#08519c","#3182bd","#6baed6","#bdd7e7","#bae4b3","#74c476","#31a354","#006d2c"];return t.remove=function(t){function n(t){t.metric.on("change.horizon-"+t.id,null),e.on("change.horizon-"+t.id,null),e.on("focus.horizon-"+t.id,null)}t.on("mousemove.horizon",null).on("mouseout.horizon",null),t.selectAll("canvas").each(n).remove(),t.selectAll(".title,.value").remove()},t.mode=function(n){return arguments.length?(r=n+"",t):r},t.height=function(n){return arguments.length?(o.height=i=+n,t):i},t.metric=function(n){return arguments.length?(l=n,t):l},t.scale=function(n){return arguments.length?(u=n,t):u},t.extent=function(n){return arguments.length?(c=n,t):c},t.title=function(n){return arguments.length?(s=n,t):s},t.format=function(n){return arguments.length?(f=n,t):f},t.colors=function(n){return arguments.length?(h=n,t):h},t},y.comparison=function(){function t(t){t.on("mousemove.comparison",function(){e.focus(Math.round(d3.mouse(this)[0]))}).on("mouseout.comparison",function(){e.focus(null)}),t.append("canvas").attr("width",r).attr("height",o),t.append("span").attr("class","title").text(c),t.append("span").attr("class","value primary"),t.append("span").attr("class","value change"),t.each(function(t,c){function v(t){_.save(),_.clearRect(0,0,r,o);var n=z.extent(),i=S.extent(),u=null==M?n:M;a.domain(u).range([o,0]),b=n.concat(i).every(isFinite);var l=t/e.step()&1?h:f;_.fillStyle=g[2];for(var c=0,s=r;s>c;++c){var m=a(z.valueAt(c)),v=a(S.valueAt(c));v>m&&_.fillRect(l(c),m,1,v-m)}for(_.fillStyle=g[0],c=0;s>c;++c){var m=a(z.valueAt(c)),v=a(S.valueAt(c));m>v&&_.fillRect(l(c),v,1,m-v)}for(_.fillStyle=g[3],c=0;s>c;++c){var m=a(z.valueAt(c)),v=a(S.valueAt(c));v>=m&&_.fillRect(l(c),m,1,d)}for(_.fillStyle=g[1],c=0;s>c;++c){var m=a(z.valueAt(c)),v=a(S.valueAt(c));m>v&&_.fillRect(l(c),m-d,1,d)}_.restore()}function y(t){null==t&&(t=r-1);var n=z.valueAt(t),e=S.valueAt(t),o=(n-e)/e;D.datum(n).text(isNaN(n)?null:s),T.datum(o).text(isNaN(o)?null:m).attr("class","value change "+(o>0?"positive":0>o?"negative":""))}function x(t,e){v(t,e),y(),b&&(z.on("change.comparison-"+A,n),S.on("change.comparison-"+A,n))}var b,w=this,A=++p,z="function"==typeof i?i.call(w,t,c):i,S="function"==typeof u?u.call(w,t,c):u,M="function"==typeof l?l.call(w,t,c):l,R=d3.select(w),_=R.select("canvas"),D=R.select(".value.primary"),T=R.select(".value.change");_.datum({id:A,primary:z,secondary:S}),_=_.node().getContext("2d"),z.on("change.comparison-"+A,x),S.on("change.comparison-"+A,x),e.on("change.comparison-"+A,v),e.on("focus.comparison-"+A,y)})}var e=this,r=e.size(),o=120,a=d3.scale.linear().interpolate(d3.interpolateRound),i=function(t){return t[0]},u=function(t){return t[1]},l=null,c=n,s=S,m=M,g=["#9ecae1","#225b84","#a1d99b","#22723a"],d=1.5;return t.remove=function(t){function n(t){t.primary.on("change.comparison-"+t.id,null),t.secondary.on("change.comparison-"+t.id,null),e.on("change.comparison-"+t.id,null),e.on("focus.comparison-"+t.id,null)}t.on("mousemove.comparison",null).on("mouseout.comparison",null),t.selectAll("canvas").each(n).remove(),t.selectAll(".title,.value").remove()},t.height=function(n){return arguments.length?(o=+n,t):o},t.primary=function(n){return arguments.length?(i=n,t):i},t.secondary=function(n){return arguments.length?(u=n,t):u},t.scale=function(n){return arguments.length?(a=n,t):a},t.extent=function(n){return arguments.length?(l=n,t):l},t.title=function(n){return arguments.length?(c=n,t):c},t.formatPrimary=function(n){return arguments.length?(s=n,t):s},t.formatChange=function(n){return arguments.length?(m=n,t):m},t.colors=function(n){return arguments.length?(g=n,t):g},t.strokeWidth=function(n){return arguments.length?(d=n,t):d},t};var S=d3.format(".2s"),M=d3.format("+.0%");y.axis=function(){function t(o){var i,u=++p,l=o.append("svg").datum({id:u}).attr("width",n.size()).attr("height",Math.max(28,-t.tickSize())).append("g").attr("transform","translate(0,"+("top"===r.orient()?27:4)+")").call(r);n.on("change.axis-"+u,function(){l.call(r),i||(i=d3.select(l.node().appendChild(l.selectAll("text").node().cloneNode(!0))).style("display","none").text(null))}),n.on("focus.axis-"+u,function(t){if(i)if(null==t)i.style("display","none"),l.selectAll("text").style("fill-opacity",null);else{i.style("display",null).attr("x",t).text(a(e.invert(t)));var n=i.node().getComputedTextLength()+6;l.selectAll("text").style("fill-opacity",function(r){return Math.abs(e(r)-t)<n?0:1})}})}var n=this,e=n.scale,r=d3.svg.axis().scale(e),o=n.step()<6e4?R:n.step()<864e5?_:D,a=o;return t.remove=function(t){function e(t){n.on("change.axis-"+t.id,null),n.on("focus.axis-"+t.id,null)}t.selectAll("svg").each(e).remove()},t.focusFormat=function(n){return arguments.length?(a=null==n?o:n,t):a==o?null:n},d3.rebind(t,r,"orient","ticks","tickSubdivide","tickSize","tickPadding","tickFormat")},d=d3.time.format,v.context().utcTime()&&(d=d3.time.format.utc);var R=d("%H:%M:%S"),_=d("%H:%M"),D=d("%B %d");y.rule=function(){function t(t){var n=++p,o=t.append("div").datum({id:n}).attr("class","line").call(m);t.each(function(n,o){function a(){for(var n=[],r=0,o=e.size();o>r;++r)l.valueAt(r)&&n.push(r);var a=t.selectAll(".metric").data(n);a.exit().remove(),a.enter().append("div").attr("class","metric line").call(m),a.style("left",g)}var i=this,u=++p,l="function"==typeof r?r.call(i,n,o):r;l&&(e.on("change.rule-"+u,a),l.on("change.rule-"+u,a))}),e.on("focus.rule-"+n,function(t){o.datum(t).style("display",null==t?"none":null).style("left",null==t?null:g)})}var e=this,r=n;return t.remove=function(t){function n(t){e.on("focus.rule-"+t.id,null)}t.selectAll(".line").each(n).remove()},t.metric=function(n){return arguments.length?(r=n,t):r},t}}(this);